<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossFit Vallecas - Planificaci√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #00adb5;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #00adb5;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .subtitle {
            color: #eeeeee;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 173, 181, 0.3);
        }
        
        .week-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        label {
            font-weight: bold;
            color: #00adb5;
            font-size: 1.1rem;
        }
        
        select {
            padding: 12px 25px;
            border-radius: 10px;
            border: 2px solid #00adb5;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 1rem;
            min-width: 250px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover {
            background: rgba(0, 173, 181, 0.1);
            transform: translateY(-2px);
        }
        
        .week-info {
            background: rgba(0, 173, 181, 0.2);
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: bold;
            border: 1px solid #00adb5;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px dashed #00adb5;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 173, 181, 0.3);
            border-top: 5px solid #00adb5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: rgba(231, 76, 60, 0.2);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e74c3c;
        }
        
        .error h3 {
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .error-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #00adb5;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0097a7;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 173, 181, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid #00adb5;
        }
        
        .btn-secondary:hover {
            background: rgba(0, 173, 181, 0.2);
            transform: translateY(-3px);
        }
        
        .week-content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(0, 173, 181, 0.3);
        }
        
        .week-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 173, 181, 0.3);
        }
        
        .week-title {
            font-size: 2rem;
            color: #00adb5;
            margin-bottom: 15px;
        }
        
        .week-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            background: rgba(0, 173, 181, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .meta-item i {
            color: #00adb5;
        }
        
        .workouts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .day-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(0, 173, 181, 0.3);
            transition: all 0.3s;
        }
        
        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 173, 181, 0.2);
            border-color: #00adb5;
        }
        
        .day-header {
            background: rgba(0, 173, 181, 0.2);
            padding: 20px;
            border-bottom: 1px solid rgba(0, 173, 181, 0.3);
        }
        
        .day-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #00adb5;
        }
        
        .day-date {
            color: #eeeeee;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .day-content {
            padding: 25px;
        }
        
        .workout-item {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .workout-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .workout-title {
            color: #00adb5;
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .workout-details {
            line-height: 1.6;
            color: #cccccc;
            white-space: pre-line;
        }
        
        .workout-details ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .workout-details li {
            margin-bottom: 8px;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .tag {
            background: rgba(0, 173, 181, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 173, 181, 0.5);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            color: #888;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: monospace;
            font-size: 0.9rem;
            border-left: 4px solid #00adb5;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            select {
                width: 100%;
            }
            
            .week-meta {
                flex-direction: column;
            }
            
            .workouts-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-dumbbell"></i> CrossFit Vallecas</h1>
            <p class="subtitle">Sistema de Planificaci√≥n para Coaches</p>
        </header>
        
        <div class="controls">
            <div class="week-selector">
                <label for="week-select"><i class="fas fa-calendar-alt"></i> Seleccionar Semana:</label>
                <select id="week-select">
                    <option value="">Cargando semanas...</option>
                </select>
            </div>
            <div class="week-info" id="week-info">
                <i class="fas fa-info-circle"></i> Semana no seleccionada
            </div>
        </div>
        
        <div class="main-content">
            <!-- Estado de carga -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Cargando configuraci√≥n...</p>
            </div>
            
            <!-- Error -->
            <div class="error" id="error" style="display: none;">
                <h3><i class="fas fa-exclamation-triangle"></i> Error</h3>
                <p id="error-message">No se pudo cargar la semana</p>
                <div class="error-actions">
                    <button class="btn-primary" id="retry-btn">
                        <i class="fas fa-redo"></i> Reintentar
                    </button>
                    <button class="btn-secondary" id="debug-btn">
                        <i class="fas fa-bug"></i> Ver detalles
                    </button>
                </div>
                <div class="debug-info" id="debug-info" style="display: none; margin-top: 20px;">
                    <!-- Informaci√≥n de debug -->
                </div>
            </div>
            
            <!-- Contenido de la semana -->
            <div class="week-content" id="week-content" style="display: none;">
                <div class="week-header">
                    <h2 class="week-title" id="week-title">Semana XX de XXXX</h2>
                    <div class="week-meta">
                        <div class="meta-item">
                            <i class="fas fa-calendar-week"></i>
                            <span id="week-dates">Fechas no disponibles</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-bullseye"></i>
                            <span id="week-focus">Enfoque principal</span>
                        </div>
                    </div>
                </div>
                
                <div class="workouts-grid" id="workouts-container">
                    <!-- Los entrenamientos se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>
        
        <footer>
            <p>CrossFit Vallecas - Sistema de Planificaci√≥n | <span id="update-time">Cargando...</span></p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                <i class="fas fa-code"></i> Modo: JSON Din√°mico | 
                <i class="fas fa-folder"></i> Archivos en: /semanas/
            </p>
        </footer>
    </div>

    <script>
        // ========== CONFIGURACI√ìN ==========
        const CONFIG_FILE = './config.json';
        const WEEKS_FOLDER = './semanas/';
        
        // ========== ESTADO ==========
        let appState = {
            semanas: [],
            semanaActual: null,
            debugMode: false
        };
        
        // ========== ELEMENTOS DOM ==========
        const weekSelect = document.getElementById('week-select');
        const weekInfo = document.getElementById('week-info');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const errorMessage = document.getElementById('error-message');
        const retryBtn = document.getElementById('retry-btn');
        const debugBtn = document.getElementById('debug-btn');
        const debugInfo = document.getElementById('debug-info');
        const weekContent = document.getElementById('week-content');
        const weekTitle = document.getElementById('week-title');
        const weekDates = document.getElementById('week-dates');
        const weekFocus = document.getElementById('week-focus');
        const workoutsContainer = document.getElementById('workouts-container');
        const updateTime = document.getElementById('update-time');
        
        // ========== INICIALIZACI√ìN ==========
        document.addEventListener('DOMContentLoaded', initApp);
        
        async function initApp() {
            console.log('üöÄ Iniciando aplicaci√≥n...');
            updateTime.textContent = new Date().toLocaleString('es-ES');
            
            // Configurar eventos
            retryBtn.addEventListener('click', loadConfig);
            debugBtn.addEventListener('click', toggleDebug);
            weekSelect.addEventListener('change', handleWeekChange);
            
            // Cargar configuraci√≥n
            await loadConfig();
        }
        
        // ========== FUNCIONES PRINCIPALES ==========
        async function loadConfig() {
            try {
                showLoading();
                hideError();
                
                console.log('üìÅ Cargando config.json...');
                const response = await fetch(CONFIG_FILE);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - No se pudo cargar config.json`);
                }
                
                const config = await response.json();
                console.log('‚úÖ Config cargada:', config);
                
                // Verificar estructura
                if (!config.semanas || !Array.isArray(config.semanas)) {
                    throw new Error('config.json debe tener un array "semanas" con nombres de archivos');
                }
                
                appState.semanas = config.semanas;
                
                // Actualizar selector
                updateWeekSelector();
                
                // Cargar primera semana si hay
                if (appState.semanas.length > 0) {
                    await loadWeek(appState.semanas[0]);
                } else {
                    showError('No hay semanas configuradas en config.json');
                }
                
            } catch (err) {
                console.error('‚ùå Error cargando config:', err);
                showError(`Error cargando configuraci√≥n: ${err.message}`);
                showDebugInfo(err);
            }
        }
        
        async function loadWeek(weekFile) {
            try {
                showLoading();
                
                console.log(`üìÅ Cargando semana: ${weekFile}`);
                const response = await fetch(WEEKS_FOLDER + weekFile);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - No se encontr√≥ ${weekFile}`);
                }
                
                const weekData = await response.json();
                console.log('‚úÖ Semana cargada:', weekData);
                
                // Validar estructura b√°sica
                if (!weekData.semana && !weekData.anio) {
                    console.warn('‚ö†Ô∏è JSON no tiene estructura esperada, pero se intentar√° renderizar');
                }
                
                appState.semanaActual = weekData;
                renderWeek(weekData);
                
                // Actualizar UI
                weekSelect.value = weekFile;
                weekInfo.innerHTML = `<i class="fas fa-check-circle"></i> ${weekFile.replace('.json', '')}`;
                updateTime.textContent = new Date().toLocaleString('es-ES');
                
                hideLoading();
                showContent();
                
            } catch (err) {
                console.error('‚ùå Error cargando semana:', err);
                showError(`No se pudo cargar ${weekFile}: ${err.message}`);
                showDebugInfo(err);
            }
        }
        
        function renderWeek(weekData) {
            // Informaci√≥n general
            weekTitle.textContent = `Semana ${weekData.semana || 'X'} de ${weekData.anio || 'XXXX'}`;
            weekDates.textContent = weekData.rango_fechas || weekData.fecha_inicio || 'Fechas no especificadas';
            weekFocus.textContent = weekData.comentario_general || weekData.enfoque || 'Entrenamiento general';
            
            // Limpiar contenedor
            workoutsContainer.innerHTML = '';
            
            // DETECTAR ESTRUCTURA DEL JSON
            let dias = [];
            
            // Estructura 1: weekData.dias (formato complejo)
            if (weekData.dias && Array.isArray(weekData.dias)) {
                console.log('üìä Estructura detectada: "dias" con programas');
                dias = weekData.dias.map(dia => ({
                    nombre: dia.nombre,
                    fecha: dia.fecha,
                    contenido: dia.programas ? renderProgramas(dia.programas) : 'Sin programas'
                }));
            }
            // Estructura 2: weekData.entrenamientos (formato simple)
            else if (weekData.entrenamientos && Array.isArray(weekData.entrenamientos)) {
                console.log('üìä Estructura detectada: "entrenamientos" simple');
                dias = weekData.entrenamientos.map(ent => ({
                    nombre: ent.dia,
                    fecha: ent.fecha,
                    contenido: renderEntrenamientoSimple(ent)
                }));
            }
            // Estructura 3: weekData es un objeto simple (como {"test": "ok"})
            else {
                console.log('üìä Estructura detectada: Objeto simple');
                dias = [{
                    nombre: 'Test',
                    fecha: 'Hoy',
                    contenido: `<div class="workout-item">
                        <h3 class="workout-title"><i class="fas fa-vial"></i> Archivo de prueba</h3>
                        <div class="workout-details">
                            <p>Este es un archivo JSON de prueba. Estructura recibida:</p>
                            <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 10px; overflow-x: auto;">${JSON.stringify(weekData, null, 2)}</pre>
                            <p class="tags">
                                <span class="tag">Test</span>
                                <span class="tag">Debug</span>
                            </p>
                        </div>
                    </div>`
                }];
            }
            
            // Renderizar d√≠as
            if (dias.length === 0) {
                workoutsContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #888;">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>No hay entrenamientos para esta semana</h3>
                        <p>El archivo JSON no contiene datos de entrenamientos.</p>
                    </div>
                `;
                return;
            }
            
            dias.forEach(dia => {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                dayCard.innerHTML = `
                    <div class="day-header">
                        <div class="day-name">${dia.nombre}</div>
                        <div class="day-date">${dia.fecha || ''}</div>
                    </div>
                    <div class="day-content">
                        ${dia.contenido}
                    </div>
                `;
                
                workoutsContainer.appendChild(dayCard);
            });
        }
        
        function renderProgramas(programas) {
            return programas.map(prog => `
                <div class="workout-item">
                    <h3 class="workout-title">
                        <i class="fas fa-${getIcon(prog.tipo)}"></i> ${prog.titulo}
                    </h3>
                    ${prog.workouts ? prog.workouts.map(w => `
                        <div style="margin-bottom: 15px;">
                            <strong>${w.titulo}:</strong>
                            <div class="workout-details">${w.detalles.replace(/\n/g, '<br>')}</div>
                        </div>
                    `).join('') : ''}
                    ${prog.feedback ? `
                        <div style="margin-top: 15px; padding: 15px; background: rgba(0,173,181,0.1); border-radius: 8px; border-left: 4px solid #00adb5;">
                            <strong><i class="fas fa-comment-medical"></i> Feedback:</strong>
                            <p style="margin-top: 8px;">${prog.feedback}</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        function renderEntrenamientoSimple(ent) {
            return `
                <div class="workout-item">
                    <h3 class="workout-title">
                        <i class="fas fa-dumbbell"></i> ${ent.titulo || 'Entrenamiento'}
                    </h3>
                    ${ent.descripcion ? `
                        <div class="workout-details">
                            <strong>Descripci√≥n:</strong><br>
                            ${ent.descripcion.replace(/\n/g, '<br>')}
                        </div>
                    ` : ''}
                    ${ent.wod ? `
                        <div class="workout-details" style="margin-top: 15px;">
                            <strong>WOD:</strong><br>
                            ${ent.wod.replace(/\n/g, '<br>')}
                        </div>
                    ` : ''}
                    ${ent.equipamiento ? `
                        <div style="margin-top: 15px;">
                            <strong><i class="fas fa-tools"></i> Equipamiento:</strong>
                            <div class="tags">
                                ${ent.equipamiento.map(eq => `<span class="tag">${eq}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function getIcon(tipo) {
            const icons = {
                'crossfit': 'fire',
                'endurance': 'running',
                'haltero': 'weight-hanging',
                'default': 'dumbbell'
            };
            return icons[tipo] || icons.default;
        }
        
        // ========== FUNCIONES AUXILIARES ==========
        function updateWeekSelector() {
            weekSelect.innerHTML = '';
            
            if (appState.semanas.length === 0) {
                weekSelect.innerHTML = '<option value="">No hay semanas</option>';
                return;
            }
            
            appState.semanas.forEach(file => {
                const option = document.createElement('option');
                option.value = file;
                option.textContent = file.replace('.json', '').replace(/_/g, ' ');
                weekSelect.appendChild(option);
            });
        }
        
        async function handleWeekChange(e) {
            const weekFile = e.target.value;
            if (weekFile) {
                await loadWeek(weekFile);
            }
        }
        
        function toggleDebug() {
            appState.debugMode = !appState.debugMode;
            debugInfo.style.display = appState.debugMode ? 'block' : 'none';
            debugBtn.innerHTML = appState.debugMode ? 
                '<i class="fas fa-times"></i> Ocultar detalles' : 
                '<i class="fas fa-bug"></i> Ver detalles';
        }
        
        function showDebugInfo(error) {
            debugInfo.innerHTML = `
                <h4><i class="fas fa-bug"></i> Informaci√≥n de depuraci√≥n:</h4>
                <p><strong>Error:</strong> ${error.message}</p>
                <p><strong>Archivos configurados:</strong> ${JSON.stringify(appState.semanas)}</p>
                <p><strong>URLs probadas:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><code>${CONFIG_FILE}</code></li>
                    ${appState.semanas.map(f => `<li><code>${WEEKS_FOLDER + f}</code></li>`).join('')}
                </ul>
                <p style="margin-top: 15px; color: #00adb5;">
                    <i class="fas fa-lightbulb"></i> 
                    <strong>Sugerencia:</strong> Aseg√∫rate de que los archivos existen en GitHub en la carpeta "semanas/"
                </p>
            `;
        }
        
        function showLoading() {
            loading.style.display = 'block';
            weekContent.style.display = 'none';
            error.style.display = 'none';
        }
        
        function hideLoading() {
            loading.style.display = 'none';
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            error.style.display = 'block';
            loading.style.display = 'none';
            weekContent.style.display = 'none';
        }
        
        function hideError() {
            error.style.display = 'none';
        }
        
        function showContent() {
            weekContent.style.display = 'block';
        }
    </script>
</body>
</html>
